{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\jiang\\\\Desktop\\\\around\\\\around-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\jiang\\\\Desktop\\\\around\\\\around-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\jiang\\\\Desktop\\\\around\\\\around-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\jiang\\\\Desktop\\\\around\\\\around-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{Tabs,Spin,Row,Col,Radio}from'antd';import{GEO_OPTIONS,POS_KEY,API_ROOT,AUTH_HEADER,TOKEN_KEY,POST_TYPE_IMAGE,POST_TYPE_VIDEO,POST_TYPE_UNKNOWN,TOPIC_AROUND,TOPIC_FACE}from'../constants';import{Gallery}from'./Gallery';import{CreatePostButton}from'./CreatePostButton';import{AroundMap}from'./AroundMap';var TabPane=Tabs.TabPane;export var Home=/*#__PURE__*/function(_React$Component){_inherits(Home,_React$Component);var _super=_createSuper(Home);function Home(){var _this;_classCallCheck(this,Home);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isLoadingGeoLocation:false,isLoadingPosts:false,error:'',posts:[],topic:TOPIC_AROUND};_this.onSuccessLoadGeoLocation=function(position){console.log(position);var _position$coords=position.coords,latitude=_position$coords.latitude,longitude=_position$coords.longitude;localStorage.setItem(POS_KEY,JSON.stringify({lat:latitude,lon:longitude}));_this.setState({isLoadingGeoLocation:false,error:''});_this.loadNearbyPosts();};_this.onFailedLoadGeoLocation=function(){_this.setState({isLoadingGeoLocation:false,error:'Failed to load geo location.'});};_this.loadNearbyPosts=function(center,radius){var _ref=center?center:JSON.parse(localStorage.getItem(POS_KEY)),lat=_ref.lat,lon=_ref.lon;var range=radius?radius:20;var token=localStorage.getItem(TOKEN_KEY);_this.setState({isLoadingPosts:true,error:''});return fetch(\"\".concat(API_ROOT,\"/search?lat=\").concat(lat,\"&lon=\").concat(lon,\"&range=\").concat(range),{method:'GET',headers:{Authorization:\"\".concat(AUTH_HEADER,\" \").concat(token)}}).then(function(response){if(response.ok){return response.json();}throw new Error('Failed to load posts.');}).then(function(data){console.log(data);_this.setState({posts:data?data:[],isLoadingPosts:false});}).catch(function(e){console.error(e);_this.setState({isLoadingPosts:false,error:e.message});});};_this.handleTopicChange=function(e){var topic=e.target.value;_this.setState({topic:topic});if(topic===TOPIC_AROUND){_this.loadNearbyPosts();}else{_this.loadFacesAroundTheWolrd();}};_this.loadFacesAroundTheWolrd=function(){var token=localStorage.getItem(TOKEN_KEY);_this.setState({isLoadingPosts:true,error:''});return fetch(\"\".concat(API_ROOT,\"/cluster?term=face\"),{method:'GET',headers:{Authorization:\"\".concat(AUTH_HEADER,\" \").concat(token)}}).then(function(response){if(response.ok){return response.json();}throw new Error('Failed to load posts');}).then(function(data){console.log(data);_this.setState({posts:data?data:[],isLoadingPosts:false});}).catch(function(e){console.error(e);_this.setState({isLoadingPosts:false,error:e.message});});};_this.loadPostsByTopic=function(center,radius){if(_this.state.topic===TOPIC_AROUND){return _this.loadNearbyPosts(center,radius);}else{return _this.loadFacesAroundTheWolrd();}};return _this;}_createClass(Home,[{key:\"componentDidMount\",value:function componentDidMount(){if(\"geolocation\"in navigator){this.setState({isLoadingGeoLocation:true,error:''});navigator.geolocation.getCurrentPosition(this.onSuccessLoadGeoLocation,this.onFailedLoadGeoLocation,GEO_OPTIONS);}else{this.setState({error:'Geolocation is not supported.'});}}},{key:\"renderImagePosts\",value:function renderImagePosts(){var posts=this.state.posts;var images=posts.filter(function(post){return post.type===POST_TYPE_IMAGE;}).map(function(post){return{user:post.user,src:post.url,thumbnail:post.url,caption:post.message,thumbnailWidth:400,thumbnailHeight:300};});return/*#__PURE__*/React.createElement(Gallery,{images:images});}},{key:\"renderVideoPosts\",value:function renderVideoPosts(){var posts=this.state.posts;return/*#__PURE__*/React.createElement(Row,{gutter:30},posts.filter(function(post){return[POST_TYPE_VIDEO,POST_TYPE_UNKNOWN].includes(post.type);}).map(function(post){return/*#__PURE__*/React.createElement(Col,{span:6,key:post.url},/*#__PURE__*/React.createElement(\"video\",{src:post.url,controls:true,className:\"video-block\"}),/*#__PURE__*/React.createElement(\"p\",null,post.user,\": \",post.message));}));}},{key:\"renderPosts\",value:function renderPosts(type){var _this$state=this.state,error=_this$state.error,isLoadingGeoLocation=_this$state.isLoadingGeoLocation,isLoadingPosts=_this$state.isLoadingPosts,posts=_this$state.posts;if(error){return error;}else if(isLoadingGeoLocation){return/*#__PURE__*/React.createElement(Spin,{tip:\"Loading geo location...\"});}else if(isLoadingPosts){return/*#__PURE__*/React.createElement(Spin,{tip:\"Loading posts...\"});}else if(posts.length>0){return type===POST_TYPE_IMAGE?this.renderImagePosts():this.renderVideoPosts();}else{return'No nearby posts';}}},{key:\"render\",value:function render(){var operations=/*#__PURE__*/React.createElement(CreatePostButton,{loadPostsByTopic:this.loadPostsByTopic});return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Radio.Group,{onChange:this.handleTopicChange,value:this.state.topic},/*#__PURE__*/React.createElement(Radio,{value:TOPIC_AROUND},\"Posts Around Me\"),/*#__PURE__*/React.createElement(Radio,{value:TOPIC_FACE},\"Faces Around The World\")),/*#__PURE__*/React.createElement(Tabs,{tabBarExtraContent:operations,className:\"main-tabs\"},/*#__PURE__*/React.createElement(TabPane,{tab:\"Image Posts\",key:\"1\"},this.renderPosts(POST_TYPE_IMAGE)),/*#__PURE__*/React.createElement(TabPane,{tab:\"Video Posts\",key:\"2\"},this.renderPosts(POST_TYPE_VIDEO)),/*#__PURE__*/React.createElement(TabPane,{tab:\"Map\",key:\"3\"},/*#__PURE__*/React.createElement(AroundMap,{googleMapURL:\"https://maps.googleapis.com/maps/api/js?key=AIzaSyD3CEh9DXuyjozqptVB5LA-dN7MxWWkr9s&v=3.exp&libraries=geometry,drawing,places\",loadingElement:/*#__PURE__*/React.createElement(\"div\",{style:{height:\"100%\"}}),containerElement:/*#__PURE__*/React.createElement(\"div\",{style:{height:\"600px\"}}),mapElement:/*#__PURE__*/React.createElement(\"div\",{style:{height:\"100%\"}}),posts:this.state.posts,loadPostsByTopic:this.loadPostsByTopic}))));}}]);return Home;}(React.Component);","map":{"version":3,"sources":["C:/Users/jiang/Desktop/around/around-web/src/components/Home.js"],"names":["React","Tabs","Spin","Row","Col","Radio","GEO_OPTIONS","POS_KEY","API_ROOT","AUTH_HEADER","TOKEN_KEY","POST_TYPE_IMAGE","POST_TYPE_VIDEO","POST_TYPE_UNKNOWN","TOPIC_AROUND","TOPIC_FACE","Gallery","CreatePostButton","AroundMap","TabPane","Home","state","isLoadingGeoLocation","isLoadingPosts","error","posts","topic","onSuccessLoadGeoLocation","position","console","log","coords","latitude","longitude","localStorage","setItem","JSON","stringify","lat","lon","setState","loadNearbyPosts","onFailedLoadGeoLocation","center","radius","parse","getItem","range","token","fetch","method","headers","Authorization","then","response","ok","json","Error","data","catch","e","message","handleTopicChange","target","value","loadFacesAroundTheWolrd","loadPostsByTopic","navigator","geolocation","getCurrentPosition","images","filter","post","type","map","user","src","url","thumbnail","caption","thumbnailWidth","thumbnailHeight","includes","length","renderImagePosts","renderVideoPosts","operations","renderPosts","height","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Tabs, Spin, Row, Col, Radio } from 'antd';\r\nimport {\r\n    GEO_OPTIONS,\r\n    POS_KEY,\r\n    API_ROOT,\r\n    AUTH_HEADER,\r\n    TOKEN_KEY,\r\n    POST_TYPE_IMAGE,\r\n    POST_TYPE_VIDEO,\r\n    POST_TYPE_UNKNOWN,\r\n    TOPIC_AROUND,\r\n    TOPIC_FACE,\r\n} from '../constants';\r\nimport { Gallery } from './Gallery';\r\nimport { CreatePostButton } from './CreatePostButton';\r\nimport { AroundMap } from './AroundMap';\r\n\r\nconst { TabPane } = Tabs;\r\n\r\nexport class Home extends React.Component {\r\n    state = {\r\n        isLoadingGeoLocation: false,\r\n        isLoadingPosts: false,\r\n        error: '',\r\n        posts: [],\r\n        topic: TOPIC_AROUND,\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (\"geolocation\" in navigator) {\r\n            this.setState({ isLoadingGeoLocation: true, error: '' });\r\n            navigator.geolocation.getCurrentPosition(\r\n                this.onSuccessLoadGeoLocation,\r\n                this.onFailedLoadGeoLocation,\r\n                GEO_OPTIONS,\r\n            );\r\n        } else {\r\n            this.setState({ error: 'Geolocation is not supported.'});\r\n        }\r\n    }\r\n\r\n    onSuccessLoadGeoLocation = (position) => {\r\n        console.log(position);\r\n        const { latitude, longitude } = position.coords;\r\n        localStorage.setItem(POS_KEY, JSON.stringify({ lat: latitude, lon: longitude }));\r\n        this.setState({ isLoadingGeoLocation: false, error: '' });\r\n        this.loadNearbyPosts();\r\n    }\r\n\r\n    onFailedLoadGeoLocation = () => {\r\n        this.setState({ isLoadingGeoLocation: false, error: 'Failed to load geo location.' });\r\n    }\r\n\r\n    loadNearbyPosts = (center, radius) => {\r\n        const { lat, lon } = center ? center : JSON.parse(localStorage.getItem(POS_KEY));\r\n        const range = radius ? radius : 20;\r\n        const token = localStorage.getItem(TOKEN_KEY);\r\n        this.setState({ isLoadingPosts: true, error: '' });\r\n        return fetch(`${API_ROOT}/search?lat=${lat}&lon=${lon}&range=${range}`, {\r\n            method: 'GET',\r\n            headers: {\r\n                Authorization: `${AUTH_HEADER} ${token}`,\r\n            }\r\n        })\r\n            .then((response) => {\r\n                if (response.ok) {\r\n                    return response.json();\r\n                }\r\n                throw new Error('Failed to load posts.');\r\n            })\r\n            .then((data) => {\r\n                console.log(data);\r\n                this.setState({ posts: data ? data : [], isLoadingPosts: false });\r\n            })\r\n            .catch((e) => {\r\n                console.error(e);\r\n                this.setState({ isLoadingPosts: false, error: e.message });\r\n            });\r\n    }\r\n\r\n    renderImagePosts() {\r\n        const { posts } = this.state;\r\n        const images = posts\r\n            .filter((post) => post.type === POST_TYPE_IMAGE)\r\n            .map((post) => {\r\n                return {\r\n                    user: post.user,\r\n                    src: post.url,\r\n                    thumbnail: post.url,\r\n                    caption: post.message,\r\n                    thumbnailWidth: 400,\r\n                    thumbnailHeight: 300,\r\n                };\r\n            });\r\n        return <Gallery images={images}/>\r\n    }\r\n\r\n    renderVideoPosts() {\r\n        const { posts } = this.state;\r\n        return (\r\n            <Row gutter={30}>\r\n                {\r\n                    posts\r\n                        .filter((post) => [POST_TYPE_VIDEO, POST_TYPE_UNKNOWN].includes(post.type))\r\n                        .map((post) => (\r\n                            <Col span={6} key={post.url}>\r\n                                <video src={post.url} controls={true} className=\"video-block\"/>\r\n                                <p>{post.user}: {post.message}</p>\r\n                            </Col>\r\n                        ))\r\n                }\r\n            </Row>\r\n        );\r\n    }\r\n\r\n    renderPosts(type) {\r\n        const { error, isLoadingGeoLocation, isLoadingPosts, posts } = this.state;\r\n        if (error) {\r\n            return error;\r\n        } else if (isLoadingGeoLocation) {\r\n            return <Spin tip=\"Loading geo location...\"/>;\r\n        } else if (isLoadingPosts) {\r\n            return <Spin tip=\"Loading posts...\"/>\r\n        } else if (posts.length > 0) {\r\n            return type === POST_TYPE_IMAGE ? this.renderImagePosts() : this.renderVideoPosts();\r\n        } else {\r\n            return 'No nearby posts';\r\n        }\r\n    }\r\n\r\n    handleTopicChange = (e) => {\r\n        const topic = e.target.value;\r\n        this.setState({ topic });\r\n        if (topic === TOPIC_AROUND) {\r\n            this.loadNearbyPosts();\r\n        } else {\r\n            this.loadFacesAroundTheWolrd();\r\n        }\r\n    }\r\n\r\n    loadFacesAroundTheWolrd = () => {\r\n        const token = localStorage.getItem(TOKEN_KEY);\r\n        this.setState({ isLoadingPosts: true, error: '' });\r\n        return fetch(`${API_ROOT}/cluster?term=face`, {\r\n            method: 'GET',\r\n            headers: {\r\n                Authorization: `${AUTH_HEADER} ${token}`,\r\n            }\r\n        })\r\n            .then((response) => {\r\n                if (response.ok) {\r\n                    return response.json();\r\n                }\r\n                throw new Error('Failed to load posts');\r\n            })\r\n            .then((data) => {\r\n                console.log(data);\r\n                this.setState({ posts: data ? data : [], isLoadingPosts: false });\r\n            })\r\n            .catch((e) => {\r\n                console.error(e);\r\n                this.setState({ isLoadingPosts: false , error: e.message });\r\n            });\r\n    }\r\n\r\n    loadPostsByTopic = (center, radius) => {\r\n        if (this.state.topic === TOPIC_AROUND) {\r\n            return this.loadNearbyPosts(center, radius);\r\n        } else {\r\n            return this.loadFacesAroundTheWolrd();\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const operations = (\r\n            <CreatePostButton loadPostsByTopic={this.loadPostsByTopic}/>\r\n        );\r\n        return (\r\n            <div>\r\n                <Radio.Group onChange={this.handleTopicChange} value={this.state.topic}>\r\n                    <Radio value={TOPIC_AROUND}>Posts Around Me</Radio>\r\n                    <Radio value={TOPIC_FACE}>Faces Around The World</Radio>\r\n                </Radio.Group>\r\n                <Tabs tabBarExtraContent={operations} className=\"main-tabs\">\r\n                    <TabPane tab=\"Image Posts\" key=\"1\">\r\n                        {this.renderPosts(POST_TYPE_IMAGE)}\r\n                    </TabPane>\r\n                    <TabPane tab=\"Video Posts\" key=\"2\">\r\n                        {this.renderPosts(POST_TYPE_VIDEO)}\r\n                    </TabPane>\r\n                    <TabPane tab=\"Map\" key=\"3\">\r\n                        <AroundMap\r\n                            googleMapURL=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyD3CEh9DXuyjozqptVB5LA-dN7MxWWkr9s&v=3.exp&libraries=geometry,drawing,places\"\r\n                            loadingElement={<div style={{ height: `100%` }} />}\r\n                            containerElement={<div style={{ height: `600px` }} />}\r\n                            mapElement={<div style={{ height: `100%` }} />}\r\n                            posts={this.state.posts}\r\n                            loadPostsByTopic={this.loadPostsByTopic}\r\n                        />\r\n                    </TabPane>\r\n                </Tabs>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}